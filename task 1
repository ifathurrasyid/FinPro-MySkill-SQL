-- show the month with the biggest transaction value in year 2021 --

select *
from 
order_detail od;

-- With normal query
select 
	to_char(order_date, 'Month') as month,
	sum(after_discount) as "transaction value"
from
	order_detail
where  
	extract (year from order_date) = 2021
and
	is_valid = 1
group by
	month
order by
	"transaction value" desc
limit
	1
;

-- With CTE
with lookup as
	(select
		to_char(od.order_date, 'Month') as month,
		round(sum(od.after_discount)) as total
	from
		order_detail od
	where
		od.is_valid = 1
	and 
		extract (year from order_date) = 2021
	group by 
		month
	order by 
		total desc
	)
select * 
from 
	lookup
limit 
	1
;
